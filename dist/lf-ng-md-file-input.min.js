!function(e){"use strict";var l=e.module("lfNgMdFileInput",["ngMaterial","ngMdIcons"]);l.filter("lfTrusted",["$sce",function(e){return function(l){return e.trustAsResourceUrl(l)}}]),l.directive("lfNgMdFileInput",["$q","$compile",function(l,i){return{restrict:"E",template:['<div class="lf-ng-md-file-input">','<div class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':bool_disabled}" ng-show="bool_file_drag || (bool_file_preview && !bool_file_null)">','<div class="close lf-ng-md-file-input-x" ng-click="removeFile($event)" ng-hide="bool_file_null" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="bool_file_null && bool_file_drag">','<div class="lf-ng-md-file-input-drag-text">Drag & drop files here ...</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div class="lf-ng-md-file-input-container" >','<div tabindex="-1" class="lf-ng-md-file-input-caption" ng-class="{\'disabled\':bool_disabled}">','<!--<span class="file-caption-ellipsis">&hellip;</span>-->','<div class="lf-ng-md-file-input-caption-text" ng-hide="bool_file_null">','<ng-md-icon icon="insert_drive_file" size="24" style="fill:black; "></ng-md-icon>',"{{str_file_name}}","</div>",'<div class="lf-ng-md-file-input-caption-text-default" ng-show="bool_file_null">'," {{str_caption_placeholder}}","</div>","</div>",'<div class="" style="position:relative;display:table-cell;width:1%;white-space:nowrap;">','<md-button type="button" ng-disabled="bool_disabled" ng-hide="bool_file_null" ng-click="removeFile()" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove">','<ng-md-icon icon="delete" size="24" style="fill:black;"></ng-md-icon>'," Remove","</md-button><!--",'--><md-button type="button" ng-disabled="bool_disabled" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower">','<ng-md-icon icon="folder_open" size="24" style="fill:white;"></ng-md-icon>'," Browse",'<input type="file" accept="{{accept}}" ng-disabled="bool_disabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfPlaceholder:"@?",accept:"@?",ngDisabled:"=?"},link:function(n,o,t){var a=e.element(o[0].querySelector(".lf-ng-md-file-input-tag")),d=e.element(o[0].querySelector(".lf-ng-md-file-input-drag")),f=e.element(o[0].querySelector(".lf-ng-md-file-input-thumbnails"));n.bool_file_preview=!1,n.bool_file_drag=!1,n.bool_file_multiple=!1,"preview"in t&&(n.bool_file_preview=!0),"drag"in t&&(n.bool_file_drag=!0),"multiple"in t?(a.attr("multiple","multiple"),n.bool_file_multiple=!0):a.removeAttr("multiple"),n.bool_disabled=!1,e.isDefined(t.ngDisabled)&&n.$watch(function(){return n.ngDisabled},function(e){n.bool_disabled=e}),n.accept=n.accept||"",n.lfFiles=[],n.bool_file_null=!0,n.str_file_name="",n.str_caption_placeholder="Select file",n.lfPlaceholder&&(n.str_caption_placeholder=n.lfPlaceholder),d.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!n.bool_disabled&&n.bool_file_drag&&d.addClass("lf-ng-md-file-input-drag-hover")}),d.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!n.bool_disabled&&n.bool_file_drag&&d.removeClass("lf-ng-md-file-input-drag-hover")}),d.bind("drop",function(l){if(l.stopPropagation(),l.preventDefault(),!n.bool_disabled&&n.bool_file_drag){d.removeClass("lf-ng-md-file-input-drag-hover"),n.lfFiles=[];var i=l.target.files||l.dataTransfer.files,o=[],t=new RegExp(n.accept,"i");if(e.forEach(i,function(e,l){e.type.match(t)&&(console.log("match true"),o.push(e))}),o.length>0&&(n.bool_file_null=!1),n.bool_file_multiple){1==o.length?n.str_file_name=""+o[0].name:n.str_file_name=""+o.length+" files selected";for(var a=0;a<o.length;a++)g(o[a],a).then(function(e){var l=o[e.index],i=l.type,t=s(l),a=window.URL.createObjectURL(l);"image"==t&&(a=e.result),n.lfFiles.push({lfFile:l,lfFileType:i,lfTagType:t,lfDataUrl:a})},function(e){},function(e){})}else o.length>=1&&(n.str_file_name=""+o[0].name,g(o[0],0).then(function(e){n.lfFiles.push({lfFile:lfFile,lfFileType:lfFileType,lfTagType:lfTagType,lfDataUrl:lfDataUrl})},function(e){},function(e){}))}}),n.removeFile=function(e){n.bool_disabled||(e&&f.empty(),n.lfFiles=[],n.str_file_name="",n.bool_file_null=!0,a.val(""))},n.removeFileAt=function(l,i){n.bool_disabled||(n.lfFiles.splice(l,1),0==n.lfFiles.length?(n.lfFiles=[],n.str_file_name="",n.bool_file_null=!0):1==n.lfFiles.length?n.str_file_name=""+n.lfFiles[0].lfFile.name:n.str_file_name=""+n.lfFiles.length+" files selected",i&&e.element(i.target).parent().remove(),console.log(n.lfFiles))},n.onFileChanged=function(l){var o=l.files;if(n.lfFiles=[],n.bool_file_null=!1,o.length>0){1==o.length?n.str_file_name=""+o[0].name:n.str_file_name=""+o.length+" files selected",console.log(o);for(var t=0;t<o.length;t++){var d=0;g(o[t],t).then(function(l){var t=l.index,r=o[t],c=r.type,u=s(r),g=window.URL.createObjectURL(r);n.lfFiles.push({lfFile:r,lfFileType:c,lfTagType:u,lfDataUrl:g});var p=e.element('<div class="lf-ng-md-file-input-frame"></div>'),m=e.element('<div class="close lf-ng-md-file-input-x" ng-click="removeFileAt('+t+',$event)">&times;</div>'),_="";_="image"==u?'<img src="'+g+'" >':"video"==u?["<video controls>",'<source src="'+g+'" type="'+c+'">',"</video>"].join(""):"audio"==u?["<audio controls>",'<source src="'+g+'" type="'+c+'">',"</audio>"].join(""):['<object data="'+g+'" type="'+c+'"><param name="movie" value="'+r.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<ng-md-icon icon="attach_file" size="160"></ng-md-icon>',"</div>","</object>"].join("");var v=e.element(_),b=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+r.name+"</div></div>");p.append(m),p.append(v),p.append(b),i(p)(n),f.append(p),d++,d==o.length&&(a.val(""),console.log(n.lfFiles))},function(e){},function(e){})}}};var s=function(e){var l=e.type,i=e.name;return console.log(e),console.log("file name : "+i),console.log("file type : "+l),r(l,i)?"image":c(l,i)?"video":u(l,i)?"audio":"object"},r=function(e,l){return e.match("image.*")||l.match(/\.(gif|png|jpe?g)$/i)?!0:!1},c=function(e,l){return e.match("video.*")||l.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},u=function(e,l){return e.match("audio.*")||l.match(/\.(ogg|mp3|wav)$/i)?!0:!1},g=function(e,i){var n=l.defer(),o=new FileReader;return o.onloadstart=function(){n.notify(0)},o.onload=function(e){console.log(e),console.log("onload"),console.log(o.result)},o.onloadend=function(e){console.log(e),console.log("on load end"),n.resolve({index:i,result:o.result})},o.onerror=function(e){n.reject(o.result)},o.onprogress=function(e){n.notify(e.loaded/e.total)},o.readAsArrayBuffer(e),n.promise}}}}])}(window.angular);