!function(e){"use strict";var i=function(){return"lfobjxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,n="x"==e?i:3&i|8;return n.toString(16)})},n=e.module("lfNgMdFileInput",["ngMaterial"]);n.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),n.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){l&&(l.$validators.required=function(e,i){return e?e.length>0:!1})}}}),n.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){if(l){var t=-1;n.$observe("lfMaxcount",function(e){var i=parseInt(e,10);t=isNaN(i)?-1:i,l.$validate()}),l.$validators.maxcount=function(e,i){return e?e.length<=t:!1}}}}}),n.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){if(l){var t=-1;n.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],r=e.match(i)[1],o=e.substring(0,e.indexOf(r));n.every(function(e,i){return r===e?(t=parseInt(o)*Math.pow(1024,i),!1):!0})}else t=-1;l.$validate()}),l.$validators.filesize=function(e,i){if(!e)return!1;var n=!0;return e.every(function(e,i){return e.lfFile.size>t?(n=!1,!1):!0}),n}}}}}),n.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(i,n,l,t){if(t){var r=-1;l.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],l=e.match(i)[1],o=e.substring(0,e.indexOf(l));n.every(function(e,i){return l===e?(r=parseInt(o)*Math.pow(1024,i),!1):!0})}else r=-1;t.$validate()}),t.$validators.totalsize=function(i,n){if(!i)return!1;var l=0;return e.forEach(i,function(e,i){l+=e.lfFile.size}),r>l}}}}}),n.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(n,l,t){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input" ng-model="'+i()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<div class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="isFilesNull && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>","</div>",'<md-button ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>"].join(""),replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",accept:"@?",ngDisabled:"=?"},link:function(i,r,o,a){var s=e.element(r[0].querySelector(".lf-ng-md-file-input-tag")),f=e.element(r[0].querySelector(".lf-ng-md-file-input-drag")),c=e.element(r[0].querySelector(".lf-ng-md-file-input-thumbnails"));i.isPreview=!1,i.isDrag=!1,i.isMutiple=!1,"preview"in o&&(i.isPreview=!0),"drag"in o&&(i.isDrag=!0),"multiple"in o?(s.attr("multiple","multiple"),i.isMutiple=!0):s.removeAttr("multiple"),i.isDisabled=!1,e.isDefined(o.ngDisabled)&&i.$watch("ngDisabled",function(e){i.isDisabled=e}),i.strBrowseIconCls="lf-browse",i.strRemoveIconCls="lf-remove",i.strCaptionIconCls="lf-caption",i.strUnknowIconCls="lf-unknow",e.isDefined(o.lfOption)&&e.isObject(i.lfOption)&&(i.lfOption.hasOwnProperty("browseIconCls")&&(i.strBrowseIconCls=i.lfOption.browseIconCls),i.lfOption.hasOwnProperty("removeIconCls")&&(i.strRemoveIconCls=i.lfOption.removeIconCls),i.lfOption.hasOwnProperty("captionIconCls")&&(i.strCaptionIconCls=i.lfOption.captionIconCls),i.lfOption.hasOwnProperty("unknowIconCls")&&(i.strUnknowIconCls=i.lfOption.unknowIconCls)),i.accept=i.accept||"",i.lfFiles=[],i[o.ngModel]=i.lfFiles,i.$watch("lfFiles.length",function(e,i){a.$validate()}),i.lfApi=new function(){var e=this;e.removeAll=function(){i.removeAllFiles()}},i.isFilesNull=!0,i.strCaption="",i.strCaptionPlaceholder="Select file",i.strCaptionDragAndDrop="Drag & drop files here...",i.strCaptionBrowse="Browse",i.strCaptionRemove="Remove",i.lfPlaceholder&&(i.strCaptionPlaceholder=i.lfPlaceholder),i.lfDragAndDropLabel&&(i.strCaptionDragAndDrop=i.lfDragAndDropLabel),i.lfBrowseLabel&&(i.strCaptionBrowse=i.lfBrowseLabel),i.lfRemoveLabel&&(i.strCaptionRemove=i.lfRemoveLabel),f.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!i.isDisabled&&i.isDrag&&f.addClass("lf-ng-md-file-input-drag-hover")}),f.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!i.isDisabled&&i.isDrag&&f.removeClass("lf-ng-md-file-input-drag-hover")}),f.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!i.isDisabled&&i.isDrag){f.removeClass("lf-ng-md-file-input-drag-hover");var n,l=e.target.files||e.dataTransfer.files,t=0;if(!(l.length<=0)){var r=i.lfFiles.map(function(e){return e.lfFileName}),o=new RegExp(i.accept,"i");if(i.isMutiple)for(t=0;t<l.length;t++)n=l[t],n.type.match(o)&&-1==r.indexOf(n.name)&&setTimeout(d(n),100*t);else for(t=0;t<l.length;t++)if(n=l[t],n.type.match(o)&&-1==r.indexOf(n.name)){i.removeAllFiles(),setTimeout(d(n),100*t);break}}}}),i.openDialog=function(e,i){-1!=navigator.userAgent.indexOf("Firefox")&&e&&t(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];void 0!==i&&i.click()},0)},i.removeAllFiles=function(e){i.isDisabled||(i.lfFiles.length=0,c.empty(),u())},i.removeFileByName=function(n,l){i.isDisabled||(i.lfFiles.every(function(e,l){return e.lfFileName==n?(i.lfFiles.splice(l,1),!1):!0}),l&&e.element(l.target).parent().remove(),u())},i.onFileChanged=function(e){var n=e.files,l=i.lfFiles.map(function(e){return e.lfFileName});if(!(n.length<=0)){if(i.isMutiple)for(var t=0;t<n.length;t++){var r=n[t],o=1;-1==l.indexOf(r.name)&&(setTimeout(d(r),100*o),o++)}else for(var t=0;t<n.length;t++){var r=n[t];if(-1==l.indexOf(r.name)){i.removeAllFiles(),setTimeout(d(r),100);break}}s.val("")}};var d=function(n){h(n).then(function(t){var r=n,o=n.name,a=n.type,s=p(n),f=window.URL.createObjectURL(n);i.lfFiles.push({lfFile:r,lfFileName:o,lfDataUrl:f});var d=e.element('<div class="lf-ng-md-file-input-frame"></div>'),m=e.element('<div class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+n.name+"',$event)\">&times;</div>"),v="";v="image"==s?'<img src="'+f+'" >':"video"==s?["<video controls>",'<source src="'+f+'" type="'+a+'">',"</video>"].join(""):"audio"==s?["<audio controls>",'<source src="'+f+'" type="'+a+'">',"</audio>"].join(""):['<object data="'+f+'" type="'+a+'"><param name="movie" value="'+r.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var g=e.element(v),h=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+r.name+"</div></div>");d.append(m),d.append(g),d.append(h),l(d)(i),c.append(d),u()},function(e){},function(e){})},u=function(){1==i.lfFiles.length?(i.strCaption=""+i.lfFiles[0].lfFileName,i.isFilesNull=!1):i.lfFiles.length>1?(i.strCaption=""+i.lfFiles.length+" files selected",i.isFilesNull=!1):(i.strCaption="",i.isFilesNull=!0)},p=function(e){var i=e.type,n=e.name;return m(i,n)?"image":v(i,n)?"video":g(i,n)?"audio":"object"},m=function(e,i){return e.match("image.*")||i.match(/\.(gif|png|jpe?g)$/i)?!0:!1},v=function(e,i){return e.match("video.*")||i.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},g=function(e,i){return e.match("audio.*")||i.match(/\.(ogg|mp3|wav)$/i)?!0:!1},h=function(e,i){var l=n.defer(),t=new FileReader;return t.onloadstart=function(){l.notify(0)},t.onload=function(e){},t.onloadend=function(e){l.resolve({index:i,result:t.result})},t.onerror=function(e){l.reject(t.result)},t.onprogress=function(e){l.notify(e.loaded/e.total)},t.readAsArrayBuffer(e),l.promise}}}}])}(window.angular);