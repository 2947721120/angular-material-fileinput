!function(l){"use strict";var e=l.module("lfNgMdFileInput",["ngMaterial","ngMdIcons"]);e.filter("lfTrusted",["$sce",function(l){return function(e){return l.trustAsResourceUrl(e)}}]),e.directive("lfNgMdFileInput",["$q",function(e,i){return{restrict:"E",template:['<div class="lf-ng-md-file-input">','<div class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':bool_disabled}" ng-show="bool_file_drag || (bool_file_preview && !bool_file_null)">','<div class="close lf-ng-md-file-input-x" ng-click="removeFile()" ng-hide="bool_file_null" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="bool_file_null && bool_file_drag">','<div class="lf-ng-md-file-input-drag-text">Drag & drop files here ...</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">','<div class="lf-ng-md-file-input-frame" ng-repeat="lffile in lfFiles">','<div class="close lf-ng-md-file-input-x" ng-click="removeFileAt($index)">&times;</div>','<img ng-if="lffile.lfTagType==\'image\'" ng-src="{{lffile.lfDataUrl | lfTrusted}}" >',"<video controls ng-if=\"lffile.lfTagType=='video'\">",'<source ng-src="{{lffile.lfDataUrl | lfTrusted}}" type={{lffile.lfType}}>',"</video>","<audio controls ng-if=\"lffile.lfTagType=='audio'\">",'<source ng-src="{{lffile.lfDataUrl | lfTrusted}}" type={{lffile.lfType}}>',"</audio>","<object ng-if=\"lffile.lfTagType=='object'\" data={{lffile.lfDataUrl}}></object>",'<div class="lf-ng-md-file-input-frame-footer">','<div class="lf-ng-md-file-input-frame-caption">{{lffile.lfFile.name}}</div>',"</div>","</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>","</div>",'<div class="lf-ng-md-file-input-container" >','<div tabindex="-1" class="lf-ng-md-file-input-caption" ng-class="{\'disabled\':bool_disabled}">','<!--<span class="file-caption-ellipsis">&hellip;</span>-->','<div class="lf-ng-md-file-input-caption-text" ng-hide="bool_file_null">','<ng-md-icon icon="insert_drive_file" size="20" style="fill:black; "></ng-md-icon>',"{{str_file_name}}","</div>",'<div class="lf-ng-md-file-input-caption-text-default" ng-show="bool_file_null">'," {{str_caption_placeholder}}","</div>","</div>",'<div class="" style="position:relative;display:table-cell;width:1%;white-space:nowrap;">','<md-button type="button" ng-disabled="bool_disabled" ng-hide="bool_file_null" ng-click="removeFile()" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove">','<ng-md-icon icon="delete" size="24" style="fill:black;"></ng-md-icon>'," Remove","</md-button><!--",'--><md-button type="button" ng-disabled="bool_disabled" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower">','<ng-md-icon icon="folder_open" size="24" style="fill:white;"></ng-md-icon>'," Browse",'<input type="file" accept="{{accept}}" ng-disabled="bool_disabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfPlaceholder:"@?",accept:"@?",ngDisabled:"=?"},link:function(i,n,t){var o=l.element(n[0].querySelector(".lf-ng-md-file-input-tag")),f=l.element(n[0].querySelector(".lf-ng-md-file-input-drag"));i.bool_file_preview=!1,i.bool_file_drag=!1,i.bool_file_multiple=!1,"preview"in t&&(i.bool_file_preview=!0),"drag"in t&&(i.bool_file_drag=!0),"multiple"in t?(o.attr("multiple","multiple"),i.bool_file_multiple=!0):o.removeAttr("multiple"),i.bool_disabled=!1,l.isDefined(t.ngDisabled)&&i.$watch(function(){return i.ngDisabled},function(l){i.bool_disabled=l}),i.accept=i.accept||"",i.lfFiles=[],i.bool_file_null=!0,i.str_file_name="",i.str_caption_placeholder="Select file",i.lfPlaceholder&&(i.str_caption_placeholder=i.lfPlaceholder),f.bind("dragover",function(l){l.stopPropagation(),l.preventDefault(),!i.bool_disabled&&i.bool_file_drag&&f.addClass("lf-ng-md-file-input-drag-hover")}),f.bind("dragleave",function(l){l.stopPropagation(),l.preventDefault(),!i.bool_disabled&&i.bool_file_drag&&f.removeClass("lf-ng-md-file-input-drag-hover")}),f.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!i.bool_disabled&&i.bool_file_drag){f.removeClass("lf-ng-md-file-input-drag-hover"),i.lfFiles=[];var n=e.target.files||e.dataTransfer.files,t=[],o=new RegExp(i.accept,"i");if(l.forEach(n,function(l,e){l.type.match(o)&&(console.log("match true"),t.push(l))}),t.length>0&&(i.bool_file_null=!1),i.bool_file_multiple){1==t.length?i.str_file_name=""+t[0].name:i.str_file_name=""+t.length+" files selected";for(var d=0;d<t.length;d++)c(t[d],d).then(function(l){var e=t[l.index],n=e.type,o=a(e),f=window.URL.createObjectURL(e);"image"==o&&(f=l.result),i.lfFiles.push({lfFile:e,lfFileType:n,lfTagType:o,lfDataUrl:f})},function(l){},function(l){})}else t.length>=1&&(i.str_file_name=""+t[0].name,c(t[0],0).then(function(l){i.lfFiles.push({lfFile:lfFile,lfFileType:lfFileType,lfTagType:lfTagType,lfDataUrl:lfDataUrl})},function(l){},function(l){}))}}),i.removeFile=function(){i.bool_disabled||(i.lfFiles=[],i.str_file_name="",i.bool_file_null=!0,o.val(""))},i.removeFileAt=function(l){i.bool_disabled||(i.lfFiles.splice(l,1),0==i.lfFiles.length?(i.lfFiles=[],i.str_file_name="",i.bool_file_null=!0):1==i.lfFiles.length?i.str_file_name=""+i.lfFiles[0].lfFile.name:i.str_file_name=""+i.lfFiles.length+" files selected")},i.onFileChanged=function(l){var e=l.files;if(i.lfFiles=[],i.bool_file_null=!1,e.length>0){1==e.length?i.str_file_name=""+e[0].name:i.str_file_name=""+e.length+" files selected",console.log(e);for(var n=0;n<e.length;n++){var t=0;c(e[n],n).then(function(l){var n=e[l.index],f=n.type,d=a(n),s=window.URL.createObjectURL(n);i.lfFiles.push({lfFile:n,lfFileType:f,lfTagType:d,lfDataUrl:s}),t++,t==e.length&&(o.val(""),console.log(i.lfFiles))},function(l){},function(l){})}}};var a=function(l){var e=l.type,i=l.name;return console.log(l),console.log("file name : "+i),console.log("file type : "+e),d(e,i)?"image":s(e,i)?"video":r(e,i)?"audio":"object"},d=function(l,e){return l.match("image.*")||e.match(/\.(gif|png|jpe?g)$/i)?!0:!1},s=function(l,e){return l.match("video.*")||e.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},r=function(l,e){return l.match("audio.*")||e.match(/\.(ogg|mp3|wav)$/i)?!0:!1},c=function(l,i){var n=e.defer(),t=new FileReader;return t.onloadstart=function(){n.notify(0)},t.onload=function(l){console.log(l),console.log("onload"),console.log(t.result)},t.onloadend=function(l){console.log(l),console.log("on load end"),n.resolve({index:i,result:t.result})},t.onerror=function(l){n.reject(t.result)},t.onprogress=function(l){n.notify(l.loaded/l.total)},t.readAsArrayBuffer(l),n.promise}}}}])}(window.angular);