!function(e){"use strict";var l=e.module("lfNgMdFileInput",["ngMaterial","ngMdIcons"]);l.filter("lfTrusted",["$sce",function(e){return function(l){return e.trustAsResourceUrl(l)}}]),l.directive("lfNgMdFileInput",["$q",function(l,i){return{restrict:"E",template:['<div class="lf-ng-md-file-input">','<div class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':bool_disabled}" ng-show="bool_file_null && bool_file_drag">','<div class="lf-ng-md-file-input-drag" >','<div class="lf-ng-md-file-input-drag-text"> Drag & drop files here ... </div>',"</div>","</div>",'<div class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':bool_disabled}" ng-hide="bool_file_null || !bool_file_preview">','<div class="close lf-ng-md-file-input-x" ng-click="removeFile()">&times;</div>','<div class="lf-ng-md-file-input-thumbnails">','<div class="lf-ng-md-file-input-frame" ng-repeat="lffile in lfFiles">','<div class="close lf-ng-md-file-input-x" ng-click="removeFileAt($index)">&times;</div>',"<img ng-if=\"lffile.lfTagType=='image'\" ng-src={{lffile.lfDataUrl}} >","<video controls ng-if=\"lffile.lfTagType=='video'\">",'<source ng-src="{{lffile.lfDataUrl | lfTrusted}}" type={{lffile.lfType}}>',"</video>","<audio controls ng-if=\"lffile.lfTagType=='audio'\">",'<source ng-src="{{lffile.lfDataUrl | lfTrusted}}" type={{lffile.lfType}}>',"</audio>","<object ng-if=\"lffile.lfTagType=='object'\" data={{lffile.lfDataUrl}}></object>",'<div class="lf-ng-md-file-input-frame-footer">','<div class="lf-ng-md-file-input-frame-caption">{{lffile.lfFile.name}}</div>',"</div>","</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div class="lf-ng-md-file-input-container" >','<div tabindex="-1" class="lf-ng-md-file-input-caption" ng-class="{\'disabled\':bool_disabled}">','<!--<span class="file-caption-ellipsis">&hellip;</span>-->','<div class="lf-ng-md-file-input-caption-text" ng-hide="bool_file_null">','<ng-md-icon icon="insert_drive_file" size="20" style="fill:black; "></ng-md-icon>',"{{str_file_name}}","</div>",'<div class="lf-ng-md-file-input-caption-text-default" ng-show="bool_file_null">'," {{str_caption_placeholder}}","</div>","</div>",'<div class="" style="position:relative;display:table-cell;width:1%;white-space:nowrap;">','<md-button type="button" ng-disabled="bool_disabled" ng-hide="bool_file_null" ng-click="removeFile()" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove">','<ng-md-icon icon="delete" size="24" style="fill:black;"></ng-md-icon>'," Remove","</md-button><!--",'--><md-button type="button" ng-disabled="bool_disabled" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower">','<ng-md-icon icon="folder_open" size="24" style="fill:white;"></ng-md-icon>'," Browse",'<input type="file" accept="{{accept}}" ng-disabled="bool_disabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfPlaceholder:"@?",accept:"@?",ngDisabled:"=?"},link:function(i,n,t){var o=e.element(n[0].querySelector(".lf-ng-md-file-input-tag")),f=e.element(n[0].querySelector(".lf-ng-md-file-input-drag"));i.bool_file_preview=!1,i.bool_file_drag=!1,i.bool_file_multiple=!1,"preview"in t&&(i.bool_file_preview=!0),"drag"in t&&(i.bool_file_drag=!0),"multiple"in t?(o.attr("multiple","multiple"),i.bool_file_multiple=!0):e.forEach(n.find("input"),function(l,i){"file"==e.element(l).attr("type")&&e.element(l).removeAttr("multiple")}),i.bool_disabled=!1,e.isDefined(t.ngDisabled)&&i.$watch(function(){return i.ngDisabled},function(e){i.bool_disabled=e}),i.accept=i.accept||"",i.lfFiles=[],i.bool_file_null=!0,i.str_file_name="",i.str_caption_placeholder="Select file",i.lfPlaceholder&&(i.str_caption_placeholder=i.lfPlaceholder),f.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),i.bool_disabled||f.addClass("lf-ng-md-file-input-drag-hover")}),f.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),i.bool_disabled||f.removeClass("lf-ng-md-file-input-drag-hover")}),f.bind("drop",function(l){if(l.stopPropagation(),l.preventDefault(),!i.bool_disabled){f.removeClass("lf-ng-md-file-input-drag-hover"),i.lfFiles=[];var n=l.target.files||l.dataTransfer.files,t=[],o=new RegExp(i.accept,"i");if(e.forEach(n,function(e,l){e.type.match(o)&&(console.log("match true"),t.push(e))}),t.length>0&&(i.bool_file_null=!1),i.bool_file_multiple){1==t.length?i.str_file_name=""+t[0].name:i.str_file_name=""+t.length+" files selected";for(var d=0;d<t.length;d++)c(t[d],d).then(function(e){var l=t[e.index],n=l.type,o=a(l),f=window.URL.createObjectURL(l);"image"==o&&(f=e.result),i.lfFiles.push({lfFile:l,lfFileType:n,lfTagType:o,lfDataUrl:f})},function(e){},function(e){})}else t.length>=1&&(i.str_file_name=""+t[0].name,c(t[0],0).then(function(e){i.lfFiles.push({lfFile:t[e.index],lfDataUrl:e.result})},function(e){},function(e){}))}}),i.removeFile=function(){i.bool_disabled||(i.lfFiles=[],i.str_file_name="",i.bool_file_null=!0,o.val(""))},i.removeFileAt=function(e){i.bool_disabled||(i.lfFiles.splice(e,1),0==i.lfFiles.length?(i.lfFiles=[],i.str_file_name="",i.bool_file_null=!0):1==i.lfFiles.length?i.str_file_name=""+i.lfFiles[0].lfFile.name:i.str_file_name=""+i.lfFiles.length+" files selected")},i.onFileChanged=function(e){console.log("onFileChanged");var l=e.files;if(i.lfFiles=[],i.bool_file_null=!1,l.length>0){1==l.length?i.str_file_name=""+l[0].name:i.str_file_name=""+l.length+" files selected";for(var n=0;n<l.length;n++){var t=0;c(l[n],n).then(function(e){var n=l[e.index],f=n.type,d=a(n),s=window.URL.createObjectURL(n);"image"==d&&(s=e.result),i.lfFiles.push({lfFile:n,lfFileType:f,lfTagType:d,lfDataUrl:s}),t++,t==l.length&&o.val("")},function(e){},function(e){})}}};var a=function(e){var l=e.type,i=e.name;return console.log("file type : "+l),d(l,i)?"image":s(l,i)?"video":r(l,i)?"audio":"object"},d=function(e,l){return e.match("image.*")||l.match(/\.(gif|png|jpe?g)$/i)?!0:!1},s=function(e,l){return e.match("video.*")||l.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},r=function(e,l){return e.match("audio.*")||l.match(/\.(ogg|mp3|wav)$/i)?!0:!1},c=function(e,i){var n=l.defer(),t=new FileReader;return t.onloadstart=function(){n.notify(0)},t.onload=function(e){n.resolve({index:i,result:t.result})},t.onloadend=function(){},t.onerror=function(e){n.reject(t.result)},t.onprogress=function(e){n.notify(e.loaded/e.total)},t.readAsDataURL(e),n.promise}}}}])}(window.angular);